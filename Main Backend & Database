<?php    
    $math = $_POST["Math"];
    $comp = $_POST["Comp"];
    $bio = $_POST["Bio"];
    $chem = $_POST["Chem"];
    $phy = $_POST["Phy"];


    $conn = new mysqli('localhost','root','','questions');
    /*if($conn->connect_error){
        die('COnnection Failed : '.$conn->connect_error);
    }else{
        $stmt = $conn->prepare("insert into registration(Name, Password, Email, Number)
        values(?, ?, ?, ?)");
        $stmt->bind_param("sssi", $name, $password, $email, $numb);
        $stmt->execute();
        echo "registration succesfully";
        $stmt->close();
        $conn->close();
    }*/

    if ($conn -> connect_errno) {
      echo "Failed to connect to MySQL: " . $conn -> connect_error;
      exit();
    }
    function Math($conn) {
        $A = 1;
        $ret ='';
        $query = "select *
        from math
        order by rand()
        limit 5;";
        $result = $conn->query($query);
        $que = array(' ',' ',' ',' ');
        if ($result->num_rows > 0) 
        {
            // OUTPUT DATA OF EACH ROW
            while($row = $result->fetch_assoc())
            {
                $ret = $row["Questions"]."|".
                    $row["Option1"]. "|".
                    $row["Option2"]."|".
                    $row["Option3"]."|".
                    $row["Option4"]."|".
                    $row["Answer"]."|";

                    $que[$A++] = $ret;
            }
        }
        return $que; 
      }

      function Comp($conn) {
        $A = 1;
        $ret ='';
        $query = "select *
        from comp
        order by rand()
        limit 5;";
        $result = $conn->query($query);
        $que = array(' ',' ',' ',' ');
        if ($result->num_rows > 0) 
        {
            // OUTPUT DATA OF EACH ROW
            while($row = $result->fetch_assoc())
            {
                $ret = $row["Questions"]."|".
                    $row["Option1"]. "|".
                    $row["Option2"]."|".
                    $row["Option3"]."|".
                    $row["Option4"]."|".
                    $row["Answer"]."|";

                    $que[$A++] = $ret;
            }
        }
        return $que; 
      }

      function Bio($conn) {
        $A = 1;
        $ret ='';
        $query = "select *
        from bio
        order by rand()
        limit 5;";
        $result = $conn->query($query);
        $que = array(' ',' ',' ',' ');
        if ($result->num_rows > 0) 
        {
            // OUTPUT DATA OF EACH ROW
            while($row = $result->fetch_assoc())
            {
                $ret = $row["Questions"]."|".
                    $row["Option1"]. "|".
                    $row["Option2"]."|".
                    $row["Option3"]."|".
                    $row["Option4"]."|".
                    $row["Answer"]."|";

                    $que[$A++] = $ret;
            }
        }
        return $que; 
      }

      function Phy($conn) {
        $A = 1;
        $ret ='';
        $query = "select *
        from phy
        order by rand()
        limit 5;";
        $result = $conn->query($query);
        $que = array(' ',' ',' ',' ');
        if ($result->num_rows > 0) 
        {
            // OUTPUT DATA OF EACH ROW
            while($row = $result->fetch_assoc())
            {
                $ret = $row["Questions"]."|".
                    $row["Option1"]. "|".
                    $row["Option2"]."|".
                    $row["Option3"]."|".
                    $row["Option4"]."|".
                    $row["Answer"]."|";

                    $que[$A++] = $ret;
            }
        }
        return $que; 
      }

      function Chem($conn) {
        $A = 1;
        $ret ='';
        $query = "select *
        from chem
        order by rand()
        limit 5;";
        $result = $conn->query($query);
        $que = array(' ',' ',' ',' ');
        if ($result->num_rows > 0) 
        {
            // OUTPUT DATA OF EACH ROW
            while($row = $result->fetch_assoc())
            {
                $ret = $row["Questions"]."|".
                    $row["Option1"]. "|".
                    $row["Option2"]."|".
                    $row["Option3"]."|".
                    $row["Option4"]."|".
                    $row["Answer"]."|";

                    $que[$A++] = $ret;
            }
        }
        return $que; 
      }
      $questions1 = $questions2 = $questions3 = $questions4 = $questions5 = array('','','','','');
      
        if(strcmp(implode(" ", $math),'on') == 1)
        $questions1 = Math($conn);
        if(strcmp(implode(" ", $comp),'on') == 1)
        $questions2 = Comp($conn);  
        if(strcmp(implode(" ", $chem),'on') == 1)
        $questions3 = Chem($conn);  
        if(strcmp(implode(" ", $bio),'on') == 1)
        $questions4 = Bio($conn);  
        if(strcmp(implode(" ", $phy),'on') == 1)
        $questions5 = Phy($conn);
        

        $questions = array_merge($questions1, array_merge($questions2, array_merge($questions3, array_merge($questions4, $questions5))));
    
    $conn -> close();
    
?>

<html>
    <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .navbar{
            background-color: rgba(37, 35, 35, 0.918);
            border-radius: 3px;
            display: block;
        }
        .navbar ul{
            overflow: auto;
            top: 0;

        }
        .navbar li{
            float:right;
            list-style: none; 
            margin: 13px 20px;
            
        }
        .navbar li a{
            padding: 3px 3px;
            color: white;
            text-decoration:solid;
        }
        .navbar li a:hover{
            color: rgb(0, 0, 0)
        }
    </style>
    </head>
    
    <body bgcolor="#1cb2ee">
    <header>
        <nav class="navbar">
            <ul>
                <li><a href="#">About Us</a></li>
                <li><a href="#">Password Generator</a></li>
                <li><a href="#">Quiz</a></li>
                <li><a href="#"></a></li>
            </ul>
        </nav>
    </header>
    <div class="quiz-container" id="quiz">
    <div class="quiz-header">
      <h2 id="question">Question Text</h2>
      <ul>
        <li>
          <input type="radio" name="answer" id="a" class="answer">
          <label for="a" id="a_text">Answer</label>
        </li>
        <li>
          <input type="radio" name="answer" id="b" class="answer">
          <label for="b" id="b_text">Answer</label>
        </li>
        <li>
          <input type="radio" name="answer" id="c" class="answer">
          <label for="c" id="c_text">Answer</label>
        </li>
        <li>
          <input type="radio" name="answer" id="d" class="answer">
          <label for="d" id="d_text">Answer</label>
        </li>
      </ul>
    </div>
    <button id="submit">Submit</button>
  </div>
        <script>

            var user = <?php
            echo
                json_encode($questions); 
            
            ?> ;

            console.log(user);


            function send(raw){
                let quest = raw.substring(0, raw.indexOf('|'));
                raw = raw.substring(raw.indexOf('|') + 1);
                let opt1 = raw.substring(0, raw.indexOf('|'));
                raw = raw.substring(raw.indexOf('|') + 1);
                let opt2 = raw.substring(0, raw.indexOf('|'));
                raw = raw.substring(raw.indexOf('|') + 1);
                let opt3 = raw.substring(0, raw.indexOf('|'));
                raw = raw.substring(raw.indexOf('|') + 1);
                let opt4 = raw.substring(0, raw.indexOf('|'));
                raw = raw.substring(raw.indexOf('|') + 1);
                let ans = raw.substring(0, raw.indexOf('|'));
                raw = raw.substring(raw.indexOf('|') + 1);
                let ret = {
                    question : quest,
                    a: opt1,
                    b: opt2,
                    c: opt3,
                    d: opt4,
                    correct: ans
                }
                return ret;
            }
            
            const quizData = [];
            const quiz1 = [];
            for(i=0;i<user.length-1;i++){
                let xyz = user[i+1]; 
                let data = send(xyz);
                quiz1[i] = data;
            }
            let a = 0;
            for(i=0;i<user.length-1;i++){
                if(quiz1[i].question != "")
                    quizData[a++] = quiz1[i];
            }


            console.log(quizData);

            const quiz= document.getElementById('quiz')
    const answerEls = document.querySelectorAll('.answer')
    const questionEl = document.getElementById('question')
    const a_text = document.getElementById('a_text')
    const b_text = document.getElementById('b_text')
    const c_text = document.getElementById('c_text')
    const d_text = document.getElementById('d_text')
    const submitBtn = document.getElementById('submit')
    let currentQuiz = 0
    let score = 0
    loadQuiz()
    function loadQuiz() {
        deselectAnswers()
        const currentQuizData = quizData[currentQuiz]
        questionEl.innerText = currentQuizData.question
        a_text.innerText = currentQuizData.a
        b_text.innerText = currentQuizData.b
        c_text.innerText = currentQuizData.c
        d_text.innerText = currentQuizData.d
    }
    function deselectAnswers() {
        answerEls.forEach(answerEl => answerEl.checked = false)
    }
    function getSelected() {
        let answer
        answerEls.forEach(answerEl => {
            if(answerEl.checked) {
                answer = answerEl.id
            }
        })
        return answer
    }

    submitBtn.addEventListener('click', () =>{
        const answer = getSelected()
        if(answer) {
            if(answer === quizData[currentQuiz].correct) {
                score++
        }
        currentQuiz++
        if(currentQuiz < quizData.length) {
           loadQuiz()
        } else {
           quiz.innerHTML = `
           <h2>You answered ${score}/${quizData.length} questions correctly</h2>;
           <button onclick="location.reload()">Reload</button>;
           `
           
        }
    }
    })
        </script>
    </body>
</html>
